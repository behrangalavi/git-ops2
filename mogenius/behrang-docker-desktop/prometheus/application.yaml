apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prometheus
  namespace: mogenius-argo-cd
  labels:
    managed-by: mogenius
spec:
  destination:
    name: in-cluster
    namespace: prometheus
  syncPolicy:
    automated:
      prune: true
  project: mogenius
  source:
    repoURL: https://helm.mogenius.com/public
    targetRevision: 1.2.2
    chart: moac
    helm:
      releaseName: prometheus
      valuesObject:
        configmaps:
          - prometheus-server:
              labels:
                app.kubernetes.io/component: server
                app.kubernetes.io/name: prometheus
                app.kubernetes.io/part-of: prometheus
                app.kubernetes.io/version: v3.6.0
              data:
                alerting_rules.yml: |
                  {}
                alerts: |
                  {}
                allow-snippet-annotations: 'false'
                prometheus.yml: |
                  global:
                    evaluation_interval: 1m
                    scrape_interval: 1m
                    scrape_timeout: 10s
                  rule_files:
                  - /etc/config/recording_rules.yml
                  - /etc/config/alerting_rules.yml
                  - /etc/config/rules
                  - /etc/config/alerts
                  scrape_configs:
                  - job_name: prometheus
                    static_configs:
                    - targets:
                      - localhost:9090
                  - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                    job_name: kubernetes-apiservers
                    kubernetes_sd_configs:
                    - role: endpoints
                    relabel_configs:
                    - action: keep
                      regex: default;kubernetes;https
                      source_labels:
                      - __meta_kubernetes_namespace
                      - __meta_kubernetes_service_name
                      - __meta_kubernetes_endpoint_port_name
                    scheme: https
                    tls_config:
                      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                  - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                    job_name: kubernetes-nodes
                    kubernetes_sd_configs:
                    - role: node
                    relabel_configs:
                    - action: labelmap
                      regex: __meta_kubernetes_node_label_(.+)
                    - replacement: kubernetes.default.svc:443
                      target_label: __address__
                    - regex: (.+)
                      replacement: /api/v1/nodes/$1/proxy/metrics
                      source_labels:
                      - __meta_kubernetes_node_name
                      target_label: __metrics_path__
                    scheme: https
                    tls_config:
                      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                  - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                    job_name: kubernetes-nodes-cadvisor
                    kubernetes_sd_configs:
                    - role: node
                    relabel_configs:
                    - action: labelmap
                      regex: __meta_kubernetes_node_label_(.+)
                    - replacement: kubernetes.default.svc:443
                      target_label: __address__
                    - regex: (.+)
                      replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
                      source_labels:
                      - __meta_kubernetes_node_name
                      target_label: __metrics_path__
                    scheme: https
                    tls_config:
                      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                  - honor_labels: true
                    job_name: kubernetes-service-endpoints
                    kubernetes_sd_configs:
                    - role: endpoints
                    relabel_configs:
                    - action: keep
                      regex: true
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_scrape
                    - action: drop
                      regex: true
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow
                    - action: replace
                      regex: (https?)
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_scheme
                      target_label: __scheme__
                    - action: replace
                      regex: (.+)
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_path
                      target_label: __metrics_path__
                    - action: replace
                      regex: (.+?)(?::\d+)?;(\d+)
                      replacement: $1:$2
                      source_labels:
                      - __address__
                      - __meta_kubernetes_service_annotation_prometheus_io_port
                      target_label: __address__
                    - action: labelmap
                      regex: __meta_kubernetes_service_annotation_prometheus_io_param_(.+)
                      replacement: __param_$1
                    - action: labelmap
                      regex: __meta_kubernetes_service_label_(.+)
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_service_name
                      target_label: service
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_pod_node_name
                      target_label: node
                  - honor_labels: true
                    job_name: kubernetes-service-endpoints-slow
                    kubernetes_sd_configs:
                    - role: endpoints
                    relabel_configs:
                    - action: keep
                      regex: true
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow
                    - action: replace
                      regex: (https?)
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_scheme
                      target_label: __scheme__
                    - action: replace
                      regex: (.+)
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_path
                      target_label: __metrics_path__
                    - action: replace
                      regex: (.+?)(?::\d+)?;(\d+)
                      replacement: $1:$2
                      source_labels:
                      - __address__
                      - __meta_kubernetes_service_annotation_prometheus_io_port
                      target_label: __address__
                    - action: labelmap
                      regex: __meta_kubernetes_service_annotation_prometheus_io_param_(.+)
                      replacement: __param_$1
                    - action: labelmap
                      regex: __meta_kubernetes_service_label_(.+)
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_service_name
                      target_label: service
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_pod_node_name
                      target_label: node
                    scrape_interval: 5m
                    scrape_timeout: 30s
                  - honor_labels: true
                    job_name: prometheus-pushgateway
                    kubernetes_sd_configs:
                    - role: service
                    relabel_configs:
                    - action: keep
                      regex: pushgateway
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_probe
                  - honor_labels: true
                    job_name: kubernetes-services
                    kubernetes_sd_configs:
                    - role: service
                    metrics_path: /probe
                    params:
                      module:
                      - http_2xx
                    relabel_configs:
                    - action: keep
                      regex: true
                      source_labels:
                      - __meta_kubernetes_service_annotation_prometheus_io_probe
                    - source_labels:
                      - __address__
                      target_label: __param_target
                    - replacement: blackbox
                      target_label: __address__
                    - source_labels:
                      - __param_target
                      target_label: instance
                    - action: labelmap
                      regex: __meta_kubernetes_service_label_(.+)
                    - source_labels:
                      - __meta_kubernetes_namespace
                      target_label: namespace
                    - source_labels:
                      - __meta_kubernetes_service_name
                      target_label: service
                  - honor_labels: true
                    job_name: kubernetes-pods
                    kubernetes_sd_configs:
                    - role: pod
                    relabel_configs:
                    - action: keep
                      regex: true
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_scrape
                    - action: drop
                      regex: true
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow
                    - action: replace
                      regex: (https?)
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_scheme
                      target_label: __scheme__
                    - action: replace
                      regex: (.+)
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_path
                      target_label: __metrics_path__
                    - action: replace
                      regex: (\d+);(([A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})
                      replacement: '[$2]:$1'
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_port
                      - __meta_kubernetes_pod_ip
                      target_label: __address__
                    - action: replace
                      regex: (\d+);((([0-9]+?)(\.|$)){4})
                      replacement: $2:$1
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_port
                      - __meta_kubernetes_pod_ip
                      target_label: __address__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_annotation_prometheus_io_param_(.+)
                      replacement: __param_$1
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: drop
                      regex: Pending|Succeeded|Failed|Completed
                      source_labels:
                      - __meta_kubernetes_pod_phase
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_pod_node_name
                      target_label: node
                  - honor_labels: true
                    job_name: kubernetes-pods-slow
                    kubernetes_sd_configs:
                    - role: pod
                    relabel_configs:
                    - action: keep
                      regex: true
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow
                    - action: replace
                      regex: (https?)
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_scheme
                      target_label: __scheme__
                    - action: replace
                      regex: (.+)
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_path
                      target_label: __metrics_path__
                    - action: replace
                      regex: (\d+);(([A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})
                      replacement: '[$2]:$1'
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_port
                      - __meta_kubernetes_pod_ip
                      target_label: __address__
                    - action: replace
                      regex: (\d+);((([0-9]+?)(\.|$)){4})
                      replacement: $2:$1
                      source_labels:
                      - __meta_kubernetes_pod_annotation_prometheus_io_port
                      - __meta_kubernetes_pod_ip
                      target_label: __address__
                    - action: labelmap
                      regex: __meta_kubernetes_pod_annotation_prometheus_io_param_(.+)
                      replacement: __param_$1
                    - action: labelmap
                      regex: __meta_kubernetes_pod_label_(.+)
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_namespace
                      target_label: namespace
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_pod_name
                      target_label: pod
                    - action: drop
                      regex: Pending|Succeeded|Failed|Completed
                      source_labels:
                      - __meta_kubernetes_pod_phase
                    - action: replace
                      source_labels:
                      - __meta_kubernetes_pod_node_name
                      target_label: node
                    scrape_interval: 5m
                    scrape_timeout: 30s
                  alerting:
                    alertmanagers:
                    - kubernetes_sd_configs:
                        - role: pod
                      tls_config:
                        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
                      relabel_configs:
                      - source_labels: [__meta_kubernetes_namespace]
                        regex: prometheus
                        action: keep
                      - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_instance]
                        regex: prometheus
                        action: keep
                      - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
                        regex: alertmanager
                        action: keep
                      - source_labels: [__meta_kubernetes_pod_container_port_number]
                        regex: "9093"
                        action: keep
                recording_rules.yml: |
                  {}
                rules: |
                  {}
          - prometheus-alertmanager:
              labels:
                app.kubernetes.io/name: alertmanager
                app.kubernetes.io/version: v0.28.1
              data:
                alertmanager.yml: |
                  global: {}
                  receivers:
                  - name: default-receiver
                  route:
                    group_interval: 5m
                    group_wait: 10s
                    receiver: default-receiver
                    repeat_interval: 3h
                  templates:
                  - /etc/alertmanager/*.tmpl
        rawResources:
          - apiVersion: apps/v1
            kind: Deployment
            metadata:
              labels:
                app.kubernetes.io/component: server
                app.kubernetes.io/name: prometheus
                app.kubernetes.io/part-of: prometheus
                app.kubernetes.io/version: v3.6.0
              name: prometheus-server
              namespace: prometheus
            spec:
              progressDeadlineSeconds: 600
              replicas: 1
              revisionHistoryLimit: 10
              selector:
                matchLabels:
                  app.kubernetes.io/component: server
                  app.kubernetes.io/instance: prometheus
                  app.kubernetes.io/name: prometheus
              strategy:
                type: Recreate
              template:
                metadata:
                  labels:
                    app.kubernetes.io/component: server
                    app.kubernetes.io/instance: prometheus
                    app.kubernetes.io/name: prometheus
                    app.kubernetes.io/part-of: prometheus
                    app.kubernetes.io/version: v3.6.0
                    helm.sh/chart: prometheus-27.40.0
                spec:
                  containers:
                    - args:
                        - '--watched-dir=/etc/config'
                        - '--listen-address=0.0.0.0:8080'
                        - '--reload-url=http://127.0.0.1:9090/-/reload'
                      image: quay.io/prometheus-operator/prometheus-config-reloader:v0.86.0
                      imagePullPolicy: IfNotPresent
                      livenessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /healthz
                          port: metrics
                          scheme: HTTP
                        initialDelaySeconds: 2
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 1
                      name: prometheus-server-configmap-reload
                      ports:
                        - containerPort: 8080
                          name: metrics
                          protocol: TCP
                      readinessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /healthz
                          port: metrics
                          scheme: HTTP
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 1
                      terminationMessagePath: /dev/termination-log
                      terminationMessagePolicy: File
                      volumeMounts:
                        - mountPath: /etc/config
                          name: config-volume
                          readOnly: true
                    - args:
                        - '--storage.tsdb.retention.time=15d'
                        - '--config.file=/etc/config/prometheus.yml'
                        - '--storage.tsdb.path=/data'
                        - '--web.console.libraries=/etc/prometheus/console_libraries'
                        - '--web.console.templates=/etc/prometheus/consoles'
                        - '--web.enable-lifecycle'
                      image: quay.io/prometheus/prometheus:v3.6.0
                      imagePullPolicy: IfNotPresent
                      livenessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /-/healthy
                          port: 9090
                          scheme: HTTP
                        initialDelaySeconds: 30
                        periodSeconds: 15
                        successThreshold: 1
                        timeoutSeconds: 10
                      name: prometheus-server
                      ports:
                        - containerPort: 9090
                          protocol: TCP
                      readinessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /-/ready
                          port: 9090
                          scheme: HTTP
                        initialDelaySeconds: 30
                        periodSeconds: 5
                        successThreshold: 1
                        timeoutSeconds: 4
                      terminationMessagePath: /dev/termination-log
                      terminationMessagePolicy: File
                      volumeMounts:
                        - mountPath: /etc/config
                          name: config-volume
                        - mountPath: /data
                          name: storage-volume
                  dnsPolicy: ClusterFirst
                  enableServiceLinks: true
                  restartPolicy: Always
                  schedulerName: default-scheduler
                  securityContext:
                    fsGroup: 65534
                    runAsGroup: 65534
                    runAsNonRoot: true
                    runAsUser: 65534
                  serviceAccount: prometheus-server
                  serviceAccountName: prometheus-server
                  terminationGracePeriodSeconds: 300
                  volumes:
                    - configMap:
                        defaultMode: 420
                        name: prometheus-server
                      name: config-volume
                    - name: storage-volume
                      persistentVolumeClaim:
                        claimName: prometheus-server
          - apiVersion: v1
            kind: PersistentVolumeClaim
            metadata:
              annotations:
                pv.kubernetes.io/bind-completed: 'yes'
                pv.kubernetes.io/bound-by-controller: 'yes'
                volume.beta.kubernetes.io/storage-provisioner: docker.io/hostpath
                volume.kubernetes.io/storage-provisioner: docker.io/hostpath
              finalizers:
                - kubernetes.io/pvc-protection
              labels:
                app.kubernetes.io/component: server
                app.kubernetes.io/name: prometheus
                app.kubernetes.io/part-of: prometheus
                app.kubernetes.io/version: v3.6.0
              name: prometheus-server
              namespace: prometheus
            spec:
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: 8Gi
              storageClassName: hostpath
              volumeMode: Filesystem
              volumeName: pvc-a52a75cf-2353-4d6f-b5f5-10edeb0bf557
          - apiVersion: v1
            kind: ServiceAccount
            metadata:
              labels:
                app.kubernetes.io/component: server
                app.kubernetes.io/name: prometheus
                app.kubernetes.io/part-of: prometheus
                app.kubernetes.io/version: v3.6.0
              name: prometheus-server
              namespace: prometheus
          - apiVersion: apps/v1
            kind: StatefulSet
            metadata:
              labels:
                app.kubernetes.io/name: alertmanager
                app.kubernetes.io/version: v0.28.1
              name: prometheus-alertmanager
              namespace: prometheus
            spec:
              persistentVolumeClaimRetentionPolicy:
                whenDeleted: Retain
                whenScaled: Retain
              podManagementPolicy: OrderedReady
              replicas: 1
              revisionHistoryLimit: 10
              selector:
                matchLabels:
                  app.kubernetes.io/instance: prometheus
                  app.kubernetes.io/name: alertmanager
              serviceName: prometheus-alertmanager-headless
              template:
                metadata:
                  annotations:
                    checksum/config: e8ccac33c408e31d8894dcd70a7fe012a635cc8bf8fadebed0c8167509b8132f
                  labels:
                    app.kubernetes.io/instance: prometheus
                    app.kubernetes.io/name: alertmanager
                spec:
                  automountServiceAccountToken: true
                  containers:
                    - args:
                        - '--storage.path=/alertmanager'
                        - '--config.file=/etc/alertmanager/alertmanager.yml'
                      env:
                        - name: POD_IP
                          valueFrom:
                            fieldRef:
                              apiVersion: v1
                              fieldPath: status.podIP
                      image: quay.io/prometheus/alertmanager:v0.28.1
                      imagePullPolicy: IfNotPresent
                      livenessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /
                          port: http
                          scheme: HTTP
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 1
                      name: alertmanager
                      ports:
                        - containerPort: 9093
                          name: http
                          protocol: TCP
                      readinessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /
                          port: http
                          scheme: HTTP
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 1
                      securityContext:
                        runAsGroup: 65534
                        runAsNonRoot: true
                        runAsUser: 65534
                      terminationMessagePath: /dev/termination-log
                      terminationMessagePolicy: File
                      volumeMounts:
                        - mountPath: /etc/alertmanager
                          name: config
                        - mountPath: /alertmanager
                          name: storage
                  dnsPolicy: ClusterFirst
                  restartPolicy: Always
                  schedulerName: default-scheduler
                  securityContext:
                    fsGroup: 65534
                    runAsGroup: 65534
                    runAsNonRoot: true
                    runAsUser: 65534
                  serviceAccount: prometheus-alertmanager
                  serviceAccountName: prometheus-alertmanager
                  terminationGracePeriodSeconds: 30
                  volumes:
                    - configMap:
                        defaultMode: 420
                        name: prometheus-alertmanager
                      name: config
              updateStrategy:
                rollingUpdate:
                  partition: 0
                type: RollingUpdate
              volumeClaimTemplates:
                - apiVersion: v1
                  kind: PersistentVolumeClaim
                  metadata:
                    creationTimestamp: null
                    name: storage
                  spec:
                    accessModes:
                      - ReadWriteOnce
                    resources:
                      requests:
                        storage: 2Gi
                    volumeMode: Filesystem
                  status:
                    phase: Pending
          - apiVersion: v1
            automountServiceAccountToken: true
            kind: ServiceAccount
            metadata:
              labels:
                app.kubernetes.io/name: alertmanager
                app.kubernetes.io/version: v0.28.1
              name: prometheus-alertmanager
              namespace: prometheus
          - apiVersion: v1
            kind: PersistentVolumeClaim
            metadata:
              annotations:
                pv.kubernetes.io/bind-completed: 'yes'
                pv.kubernetes.io/bound-by-controller: 'yes'
                volume.beta.kubernetes.io/storage-provisioner: docker.io/hostpath
                volume.kubernetes.io/storage-provisioner: docker.io/hostpath
              finalizers:
                - kubernetes.io/pvc-protection
              labels:
                app.kubernetes.io/name: alertmanager
              name: storage-prometheus-alertmanager-0
              namespace: prometheus
            spec:
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: 2Gi
              storageClassName: hostpath
              volumeMode: Filesystem
              volumeName: pvc-19b2528d-64e6-40c3-a23b-92864b2e2457
          - apiVersion: apps/v1
            kind: DaemonSet
            metadata:
              annotations:
                deprecated.daemonset.template.generation: '1'
              labels:
                app.kubernetes.io/component: metrics
                app.kubernetes.io/name: prometheus-node-exporter
                app.kubernetes.io/part-of: prometheus-node-exporter
                app.kubernetes.io/version: 1.9.1
              name: prometheus-prometheus-node-exporter
              namespace: prometheus
            spec:
              revisionHistoryLimit: 10
              selector:
                matchLabels:
                  app.kubernetes.io/instance: prometheus
                  app.kubernetes.io/name: prometheus-node-exporter
              template:
                metadata:
                  annotations:
                    cluster-autoscaler.kubernetes.io/safe-to-evict: 'true'
                  labels:
                    app.kubernetes.io/component: metrics
                    app.kubernetes.io/instance: prometheus
                    app.kubernetes.io/managed-by: Helm
                    app.kubernetes.io/name: prometheus-node-exporter
                    app.kubernetes.io/part-of: prometheus-node-exporter
                    app.kubernetes.io/version: 1.9.1
                    helm.sh/chart: prometheus-node-exporter-4.48.0
                spec:
                  affinity:
                    nodeAffinity:
                      requiredDuringSchedulingIgnoredDuringExecution:
                        nodeSelectorTerms:
                          - matchExpressions:
                              - key: eks.amazonaws.com/compute-type
                                operator: NotIn
                                values:
                                  - fargate
                              - key: type
                                operator: NotIn
                                values:
                                  - virtual-kubelet
                  automountServiceAccountToken: false
                  containers:
                    - args:
                        - '--path.procfs=/host/proc'
                        - '--path.sysfs=/host/sys'
                        - '--path.rootfs=/host/root'
                        - '--path.udev.data=/host/root/run/udev/data'
                        - '--web.listen-address=[$(HOST_IP)]:9100'
                      env:
                        - name: HOST_IP
                          value: 0.0.0.0
                      image: quay.io/prometheus/node-exporter:v1.9.1
                      imagePullPolicy: IfNotPresent
                      livenessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /
                          port: metrics
                          scheme: HTTP
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 1
                      name: node-exporter
                      ports:
                        - containerPort: 9100
                          name: metrics
                          protocol: TCP
                      readinessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /
                          port: metrics
                          scheme: HTTP
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 1
                      securityContext:
                        allowPrivilegeEscalation: false
                        readOnlyRootFilesystem: true
                      terminationMessagePath: /dev/termination-log
                      terminationMessagePolicy: File
                      volumeMounts:
                        - mountPath: /host/proc
                          name: proc
                          readOnly: true
                        - mountPath: /host/sys
                          name: sys
                          readOnly: true
                        - mountPath: /host/root
                          mountPropagation: HostToContainer
                          name: root
                          readOnly: true
                  dnsPolicy: ClusterFirst
                  hostNetwork: true
                  hostPID: true
                  nodeSelector:
                    kubernetes.io/os: linux
                  restartPolicy: Always
                  schedulerName: default-scheduler
                  securityContext:
                    fsGroup: 65534
                    runAsGroup: 65534
                    runAsNonRoot: true
                    runAsUser: 65534
                  serviceAccount: prometheus-prometheus-node-exporter
                  serviceAccountName: prometheus-prometheus-node-exporter
                  terminationGracePeriodSeconds: 30
                  tolerations:
                    - effect: NoSchedule
                      operator: Exists
                  volumes:
                    - hostPath:
                        path: /proc
                        type: ''
                      name: proc
                    - hostPath:
                        path: /sys
                        type: ''
                      name: sys
                    - hostPath:
                        path: /
                        type: ''
                      name: root
              updateStrategy:
                rollingUpdate:
                  maxSurge: 0
                  maxUnavailable: 1
                type: RollingUpdate
          - apiVersion: v1
            automountServiceAccountToken: false
            kind: ServiceAccount
            metadata:
              labels:
                app.kubernetes.io/component: metrics
                app.kubernetes.io/name: prometheus-node-exporter
                app.kubernetes.io/part-of: prometheus-node-exporter
                app.kubernetes.io/version: 1.9.1
              name: prometheus-prometheus-node-exporter
              namespace: prometheus
          - apiVersion: v1
            automountServiceAccountToken: true
            kind: ServiceAccount
            metadata:
              labels:
                app.kubernetes.io/component: metrics
                app.kubernetes.io/name: kube-state-metrics
                app.kubernetes.io/part-of: kube-state-metrics
                app.kubernetes.io/version: 2.17.0
              name: prometheus-kube-state-metrics
              namespace: prometheus
          - apiVersion: apps/v1
            kind: Deployment
            metadata:
              labels:
                app.kubernetes.io/component: metrics
                app.kubernetes.io/name: kube-state-metrics
                app.kubernetes.io/part-of: kube-state-metrics
                app.kubernetes.io/version: 2.17.0
              name: prometheus-kube-state-metrics
              namespace: prometheus
            spec:
              progressDeadlineSeconds: 600
              replicas: 1
              revisionHistoryLimit: 10
              selector:
                matchLabels:
                  app.kubernetes.io/instance: prometheus
                  app.kubernetes.io/name: kube-state-metrics
              strategy:
                rollingUpdate:
                  maxSurge: 25%
                  maxUnavailable: 25%
                type: RollingUpdate
              template:
                metadata:
                  labels:
                    app.kubernetes.io/component: metrics
                    app.kubernetes.io/instance: prometheus
                    app.kubernetes.io/managed-by: Helm
                    app.kubernetes.io/name: kube-state-metrics
                    app.kubernetes.io/part-of: kube-state-metrics
                    app.kubernetes.io/version: 2.17.0
                    helm.sh/chart: kube-state-metrics-6.3.0
                spec:
                  automountServiceAccountToken: true
                  containers:
                    - args:
                        - '--port=8080'
                        - '--resources=certificatesigningrequests,configmaps,cronjobs,daemonsets,deployments,endpoints,horizontalpodautoscalers,ingresses,jobs,leases,limitranges,mutatingwebhookconfigurations,namespaces,networkpolicies,nodes,persistentvolumeclaims,persistentvolumes,poddisruptionbudgets,pods,replicasets,replicationcontrollers,resourcequotas,secrets,services,statefulsets,storageclasses,validatingwebhookconfigurations,volumeattachments'
                      image: registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.17.0
                      imagePullPolicy: IfNotPresent
                      livenessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /livez
                          port: 8080
                          scheme: HTTP
                        initialDelaySeconds: 5
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 5
                      name: kube-state-metrics
                      ports:
                        - containerPort: 8080
                          name: http
                          protocol: TCP
                      readinessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /readyz
                          port: 8081
                          scheme: HTTP
                        initialDelaySeconds: 5
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 5
                      securityContext:
                        allowPrivilegeEscalation: false
                        capabilities:
                          drop:
                            - ALL
                        readOnlyRootFilesystem: true
                      terminationMessagePath: /dev/termination-log
                      terminationMessagePolicy: File
                  dnsPolicy: ClusterFirst
                  restartPolicy: Always
                  schedulerName: default-scheduler
                  securityContext:
                    fsGroup: 65534
                    runAsGroup: 65534
                    runAsNonRoot: true
                    runAsUser: 65534
                    seccompProfile:
                      type: RuntimeDefault
                  serviceAccount: prometheus-kube-state-metrics
                  serviceAccountName: prometheus-kube-state-metrics
                  terminationGracePeriodSeconds: 30
          - apiVersion: v1
            automountServiceAccountToken: true
            kind: ServiceAccount
            metadata:
              labels:
                app.kubernetes.io/name: prometheus-pushgateway
                app.kubernetes.io/version: v1.11.1
              name: prometheus-prometheus-pushgateway
              namespace: prometheus
          - apiVersion: apps/v1
            kind: Deployment
            metadata:
              annotations: {}
              labels:
                app.kubernetes.io/name: prometheus-pushgateway
                app.kubernetes.io/version: v1.11.1
              name: prometheus-prometheus-pushgateway
              namespace: prometheus
            spec:
              progressDeadlineSeconds: 600
              replicas: 1
              revisionHistoryLimit: 10
              selector:
                matchLabels:
                  app.kubernetes.io/instance: prometheus
                  app.kubernetes.io/name: prometheus-pushgateway
              strategy:
                type: Recreate
              template:
                metadata:
                  labels:
                    app.kubernetes.io/instance: prometheus
                    app.kubernetes.io/managed-by: Helm
                    app.kubernetes.io/name: prometheus-pushgateway
                    app.kubernetes.io/version: v1.11.1
                    helm.sh/chart: prometheus-pushgateway-3.4.1
                spec:
                  automountServiceAccountToken: true
                  containers:
                    - image: quay.io/prometheus/pushgateway:v1.11.1
                      imagePullPolicy: IfNotPresent
                      livenessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /-/healthy
                          port: 9091
                          scheme: HTTP
                        initialDelaySeconds: 10
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 10
                      name: pushgateway
                      ports:
                        - containerPort: 9091
                          name: metrics
                          protocol: TCP
                      readinessProbe:
                        failureThreshold: 3
                        httpGet:
                          path: /-/ready
                          port: 9091
                          scheme: HTTP
                        initialDelaySeconds: 10
                        periodSeconds: 10
                        successThreshold: 1
                        timeoutSeconds: 10
                      resources: {}
                      terminationMessagePath: /dev/termination-log
                      terminationMessagePolicy: File
                      volumeMounts:
                        - mountPath: /data
                          name: storage-volume
                  dnsPolicy: ClusterFirst
                  restartPolicy: Always
                  schedulerName: default-scheduler
                  securityContext:
                    fsGroup: 65534
                    runAsNonRoot: true
                    runAsUser: 65534
                  serviceAccount: prometheus-prometheus-pushgateway
                  serviceAccountName: prometheus-prometheus-pushgateway
                  terminationGracePeriodSeconds: 30
                  volumes:
                    - emptyDir: {}
                      name: storage-volume
        services:
          - prometheus-server:
              labels:
                app.kubernetes.io/component: server
                app.kubernetes.io/name: prometheus
                app.kubernetes.io/part-of: prometheus
                app.kubernetes.io/version: v3.6.0
              clusterIP: 10.104.41.250
              clusterIPs:
                - 10.104.41.250
              internalTrafficPolicy: Cluster
              ipFamilies:
                - IPv4
              ipFamilyPolicy: SingleStack
              ports:
                - name: http
                  port: 80
                  protocol: TCP
                  targetPort: 9090
              selector:
                app.kubernetes.io/component: server
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: prometheus
              sessionAffinity: None
              type: ClusterIP
          - prometheus-alertmanager-headless:
              labels:
                app.kubernetes.io/name: alertmanager
                app.kubernetes.io/version: v0.28.1
              clusterIP: None
              clusterIPs:
                - None
              internalTrafficPolicy: Cluster
              ipFamilies:
                - IPv4
              ipFamilyPolicy: SingleStack
              ports:
                - name: http
                  port: 9093
                  protocol: TCP
                  targetPort: http
              selector:
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: alertmanager
              sessionAffinity: None
              type: ClusterIP
          - prometheus-alertmanager:
              labels:
                app.kubernetes.io/name: alertmanager
                app.kubernetes.io/version: v0.28.1
              clusterIP: 10.105.120.164
              clusterIPs:
                - 10.105.120.164
              internalTrafficPolicy: Cluster
              ipFamilies:
                - IPv4
              ipFamilyPolicy: SingleStack
              ports:
                - name: http
                  port: 9093
                  protocol: TCP
                  targetPort: http
              selector:
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: alertmanager
              sessionAffinity: None
              type: ClusterIP
          - prometheus-prometheus-node-exporter:
              annotations:
                prometheus.io/scrape: 'true'
              labels:
                app.kubernetes.io/component: metrics
                app.kubernetes.io/name: prometheus-node-exporter
                app.kubernetes.io/part-of: prometheus-node-exporter
                app.kubernetes.io/version: 1.9.1
              clusterIP: 10.99.202.222
              clusterIPs:
                - 10.99.202.222
              internalTrafficPolicy: Cluster
              ipFamilies:
                - IPv4
              ipFamilyPolicy: SingleStack
              ports:
                - name: metrics
                  port: 9100
                  protocol: TCP
                  targetPort: 9100
              selector:
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: prometheus-node-exporter
              sessionAffinity: None
              type: ClusterIP
          - prometheus-kube-state-metrics:
              annotations:
                prometheus.io/scrape: 'true'
              labels:
                app.kubernetes.io/component: metrics
                app.kubernetes.io/name: kube-state-metrics
                app.kubernetes.io/part-of: kube-state-metrics
                app.kubernetes.io/version: 2.17.0
              clusterIP: 10.97.104.168
              clusterIPs:
                - 10.97.104.168
              internalTrafficPolicy: Cluster
              ipFamilies:
                - IPv4
              ipFamilyPolicy: SingleStack
              ports:
                - name: http
                  port: 8080
                  protocol: TCP
                  targetPort: http
              selector:
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: kube-state-metrics
              sessionAffinity: None
              type: ClusterIP
          - prometheus-prometheus-pushgateway:
              annotations:
                prometheus.io/probe: pushgateway
              labels:
                app.kubernetes.io/name: prometheus-pushgateway
                app.kubernetes.io/version: v1.11.1
              clusterIP: 10.98.55.102
              clusterIPs:
                - 10.98.55.102
              internalTrafficPolicy: Cluster
              ipFamilies:
                - IPv4
              ipFamilyPolicy: SingleStack
              ports:
                - name: http
                  port: 9091
                  protocol: TCP
                  targetPort: 9091
              selector:
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: prometheus-pushgateway
              sessionAffinity: None
              type: ClusterIP
